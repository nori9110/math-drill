# 算数ドリルアプリ 追加機能要件定義

## 1. メール送信機能

### 概要
ユーザーが保護者や教師に学習結果を送信できる機能を追加します。Gmail APIを利用して実装します。

### 機能要件
1. **送信タイミング**
   - 問題の結果画面で送信ボタンを表示
   - 履歴詳細画面での過去の結果送信も可能

2. **送信内容**
   - ユーザー名
   - 問題の種類
   - 問題数と正解数
   - 正答率
   - 所要時間
   - 間違えた問題のリスト（任意）

3. **送信先設定**
   - 送信先メールアドレスの入力
   - よく使うメールアドレスの保存機能（最大3件）

4. **GoogleAppsScript連携**
   - フロントエンドからのデータをGoogleAppsScriptで受け取り
   - メール本文のテンプレート化
   - 送信者は固定アドレス（例：math-drill@example.com）

5. **UIデザイン**
   - 結果画面にメール送信ボタンを追加
   - 送信先入力モーダルの実装
   - 送信完了/エラー通知

## 2. プライバシーポリシーと運営団体情報

### 概要
アプリのプライバシーポリシーと運営団体情報を表示する機能を追加します。

### 機能要件
1. **表示場所**
   - ログイン画面のフッター
   - 設定画面のフッター

2. **プライバシーポリシー**
   - 個人情報の取り扱い
   - Cookieの使用
   - ローカルストレージの使用説明
   - メール送信時のデータ取り扱い
   - 第三者提供の有無

3. **運営団体情報**
   - 団体名
   - 連絡先
   - 責任者
   - サポート情報

4. **UIデザイン**
   - フッターにリンクを配置
   - モーダルもしくは専用ページでの表示
   - 既存のアプリデザインと統一感を持たせる

## 3. アンケート収集機能

### 概要
ユーザーからのフィードバックを収集するためのアンケート機能を実装します。回答はGoogleスプレッドシートに蓄積します。

### 機能要件
1. **アンケート表示タイミング**
   - 初回利用から5回目の問題完了時
   - 月に1回程度（最終アンケートから30日経過時）
   - 任意回答（スキップ可能）

2. **アンケート内容**
   - 満足度評価（5段階）
   - 使いやすさ評価（5段階）
   - 難易度評価（3段階：簡単/ちょうどよい/難しい）
   - 改善要望（自由記述）
   - 追加してほしい機能（自由記述）

3. **GoogleスプレッドシートAPI連携**
   - アンケート回答の自動送信
   - ユーザーIDと回答日時の記録
   - 回答データの集計機能

4. **UIデザイン**
   - モーダルでのアンケート表示
   - 子供向けの分かりやすいデザイン
   - 送信完了時のお礼メッセージ

## 技術仕様

### 1. メール送信機能
- REST API: GoogleAppsScriptをエンドポイントとして利用
- データフォーマット: JSON
- 認証: API Keyによる簡易認証
- エラーハンドリング: 送信失敗時のリトライ機能

### 2. プライバシーポリシー・運営団体情報
- 静的コンテンツ: Markdownから変換されたHTML
- ルーティング: React Routerによる専用ページ実装
- スタイリング: 既存のTailwind CSSを活用

### 3. アンケート機能
- Google Sheets API: アンケート結果の記録
- データ保存: ローカルストレージでのアンケート回答履歴管理
- 送信タイミング: ユーザーの利用状況に基づく条件判定

## データモデル拡張

### User拡張
```typescript
type User = {
  username: string;
  grade: 1 | 2 | 3 | 4;
  emailAddresses?: string[]; // 保存されたメールアドレスリスト
  lastSurveyDate?: string;   // 最後にアンケートに回答した日時
  surveyCount?: number;      // アンケート回答回数
};
```

### Survey（新規）
```typescript
type Survey = {
  id: string;
  userId: string;
  date: string;
  satisfaction: 1 | 2 | 3 | 4 | 5;
  usability: 1 | 2 | 3 | 4 | 5;
  difficulty: 'easy' | 'appropriate' | 'difficult';
  improvementSuggestions?: string;
  featureRequests?: string;
};
```

### AppState拡張
```typescript
type AppState = {
  // 既存の状態
  screen: 'login' | 'settings' | 'drill' | 'word-problem' | 'flash' | 'result' | 'history' | 'history-detail' | 'privacy-policy' | 'about-us';
  // 追加の状態
  isPrivacyPolicyVisible?: boolean;
  isAboutUsVisible?: boolean;
  isSurveyVisible?: boolean;
  currentSurvey?: Survey;
};
```

## 実装スケジュール

1. **フェーズ1: プライバシーポリシー・運営団体情報（1週間）**
   - 静的ページの作成
   - フッターリンクの実装
   - モバイル対応

2. **フェーズ2: アンケート機能（2週間）**
   - UI設計と実装
   - GoogleスプレッドシートAPI連携
   - ユーザー状態管理の拡張

3. **フェーズ3: メール送信機能（2週間）**
   - UI設計と実装
   - GoogleAppsScript開発
   - テスト環境での動作確認

## テスト計画

1. **ユニットテスト**
   - 各コンポーネントの機能テスト
   - APIリクエスト処理のモック

2. **統合テスト**
   - 画面遷移の検証
   - データの永続化確認

3. **ユーザビリティテスト**
   - 子供向けUIの使いやすさ検証
   - 保護者/教師からのフィードバック収集 